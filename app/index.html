<!doctype html>
<html lang="en" xmlns:ng="http://angularjs.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/json; charset=UTF-8">
  <title>Ng menu</title>

 <style> 
 /* app css stylesheet */

/*Menu css setup*/
menu li { display: inline; }
.active { background-color: red; }

     a {
         text-decoration: none;
     }
 </style>
<!-- Angular seed -->
  <script type="application/javascript" src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.5/angular.min.js"></script>
 
 <!-- Example Data source -->
 <script> 
var dataSrc =[
    {
        "activeIdx":2,
        "name": "User",
        "title":"user",
        "url":'/ng-test-prj/app/index.html',
//        "renderLevel":2,
        "submenu": [{
            "name": "Add User",
            "title":"Add user",
            "url":'#'
        },{
            "name": "Edit User",
            "title":"Edit user",
            "url":'#'
        }]
    },{
        "name": "Video",
        "title":"video",
        "url":'#'
        },{
        "name": "Player",
        "title":"player",
        "url":'#',
//        "renderLevel":3,
        "submenu": [{
            "name": "Add Player",
            "title":"Add Player",
            "url":'#',
            "submenu": [{
              "name": "Add subPlayer",
              "title":"Add subPlayer",
              "url":'/ng-test-prj/app/'
            },{
              "name": "Edit subPlayer",
              "title":"Edit subPlayer",
              "url":'#'
            }]
        },{
            "name": "Edit Player",
            "title":"Edit Player",
            "url":'#',
            "submenu": [{
                "name": "Add _subPlayer",
                "title":"Add _subPlayer",
                "url":'#'
              },{
                "name": "Edit _subPlayer",
                "title":"Edit _subPlayer",
                "url":'#',
                "submenu": [{
                    "name": "Add _subPlayer",
                    "title":"Add _subPlayer",
                    "url":'#',
                    "submenu": [{
                        "name": "Add _subPlayer",
                        "title":"Add _subPlayer",
                        "url":'#'
                    },{
                        "name": "Edit _subPlayer",
                        "title":"Edit _subPlayer",
                        "url":'#'
                    }]
                },{
                    "name": "Edit _subPlayer",
                    "title":"Edit _subPlayer",
                    "url":'#'
                }]
              }]
        }]
    },{
        "name": "Playlist",
        "title":"Playlist",
        "url":'#'
    },{
        "name": "User-Account",
        "title":"user-account",
        "url":'#'
    }
]; 
 </script>


  <script>
        'use strict';
        /* App Module */
        angular.module('menuApp', ['menuAppFilters']);

        /* Controllers */
        function MenuCtrl($scope,$location,$window) {
            $scope.menuApp = {"src":[],"active":false,"maxRenderLvl":1,"itemLvl":0,"fullActivePath":false};

            angular.forEach(dataSrc,function(v,k){
                var lvlCounter = 0;
                addMenuParams({"item":  v, "lvlCounter": lvlCounter, "idx": k, "fullPath":k });
                checkMenuURl(v, $scope.menuApp);

                if(typeof v.submenu=='object')
                   this.push(
                     (function getSubLvl(v,lvlCounter,parentIdx){
                         lvlCounter++;
                         for(var idx in v.submenu){
                             addMenuParams({"item":v.submenu[idx],"lvlCounter": lvlCounter,"idx": idx,"parent": k,"fullPath":parentIdx+"_"+idx});
                             checkMenuURl(v.submenu[idx], v);

                             if(typeof v.submenu[idx].submenu=='object'){
                                 lvlCounter++;
                                 for(var index in v.submenu[idx].submenu){
                                     addMenuParams({ "item":v.submenu[idx].submenu[index], "lvlCounter": lvlCounter, "idx": index, "parent": idx,"fullPath":parentIdx+"_"+idx+"_"+index });
                                     checkMenuURl(v.submenu[idx].submenu[index], v.submenu[idx]);

                                     v.submenu[idx].submenu[index] = getSubLvl(v.submenu[idx].submenu[index],lvlCounter,parentIdx+"_"+idx+"_"+index);
                                 }
                             }
                         }
                         return v;
                     })(v,lvlCounter,k) // recursive getSubLvl
                    );  // push
                else
                    this.push(v);

            },$scope.menuApp.src); //ngForEach

            console.info($scope.menuApp);

            function addMenuParams(){ // console.log(arguments[0]);
                if(typeof arguments[0] == "object") {
                    arguments[0].item.itemLvl = parseInt(arguments[0].lvlCounter);
                    arguments[0].item.itemIdx = parseInt(arguments[0].idx);

                    if (typeof  arguments[0].parent !== 'undefined')
                        arguments[0].item.itemParentIdx = parseInt(arguments[0].parent);

                    if (typeof  arguments[0].fullPath !== 'undefined')
                        arguments[0].item.fullPath = arguments[0].fullPath;
                }
            }

            function checkMenuURl(v,itemLvl) {
                if(v.url == $window.location.pathname){
                    itemLvl.active = v;
                    itemLvl.activeIdx = v.itemIdx;
                    $scope.menuApp.fullActivePath = v.fullPath;
                }
            }

        }  MenuCtrl.$inject = ['$scope','$location','$window'];

        /* Filters */
        angular.module('menuAppFilters', []).filter('active', function() {
            return function(input) {
                return input ? 'active' : '';
            };
        });
  </script>
</head>
<body ng-app="menuApp">

	<menu ng-controller="MenuCtrl">

			<ul>
		      <li ng-repeat="menu in menuApp.src" class="{{(menu.itemIdx==menuApp.active.itemIdx) | active}}">
			    <a>  {{ menu.name }} </a>
			  </li>
			</ul>     

			<ul ng-hide="!menuApp.active && menuApp.active.submenu">
			  <li ng-repeat="submenu in menuApp.active.submenu" class="{{(submenu.itemIdx==menuApp.active.itemIdx) | active}}">
                  <a>  {{ submenu.name }} </a>
			  </li>
			</ul>

	</menu>

    <!--
        <li ng-repeat="menu in menus" title="{{menu.title}}" class="{{menu.active | active}}">
             <a ng-click="active()" href="{{menu.url}}"> {{menu.name}} </a>
        </li>
    -->
</body>
</html>
